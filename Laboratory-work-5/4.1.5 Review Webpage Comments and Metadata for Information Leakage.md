# 4.1.5 - Огляд Змісту Веб-Сторінки на Предмет Витоку Інформації

# Підсумки

Для програмістів є дуже поширеною практикою, і навіть рекомендованою, включати детальні коментарі та метадані до свого вихідного коду. Однак коментарі та метадані, включені в HTML-код, можуть розкривати внутрішню інформацію, яка не повинна бути доступною для потенційних зловмисників. Має бути здійсненим перегляд коментарів та метаданих, щоб визначити, чи не відбувається витік інформації.

Для сучасних веб-додатків, використання JavaScript на стороні клієнту для інтерфейсу стає все більш популярним. Популярні технології побудови інтерфейсу використовують клієнтський JavaScript, такі як ReactJS, AngularJS або Vue. Подібно до коментарів та метаданих у HTML-коді, багато програмістів також вбудовують конфіденційну інформацію прямо в код, у змінні JavaScript на користувацькій частині додатку. Конфіденційна інформація може включати (але не обмежується): Приватні ключі API (наприклад, незахищений ключ API Google Map), внутрішні IP-адреси, конфіденційні маршрути (наприклад, маршрут до прихованих сторінок адміністратора або функціональних можливостей) або навіть облікові дані. Ця конфіденційна інформація може витікати з подібного клієнтського JavaScript коду. Необхідно провести перевірку, щоб визначити, чи не стався витік конфіденційної інформації, яка може бути використана зловмисниками для зловживань.

Для великих веб-додатків питання продуктивності викликає велике занепокоєння у програмістів. Програмісти використовують різні методи для оптимізації продуктивності інтерфейсу, зокрема Syntactically Awesome Style Sheets (SASS), Sassy CSS (SCSS), webpack тощо. Використовуючи ці технології, інтерфейсний код іноді стає важчим для розуміння і складнішим для відлагодження, і через це програмісти часто розгортають файли карт вихідного коду для цілей налагодження. "Карта коду" - це спеціальний файл, який з'єднує мінімізовану/розширену версію ресурсу (CSS або JavaScript) з оригінальною авторською версією. Програмісти все ще сперечаються, чи варто використовувати файли карт коду у виробничому середовищі. Однак, не можна заперечувати, що карти коду або файли для налагодження, якщо випущені у виробниче середовище, зроблять їхній вихідний код більш читабельним для людини. Це може полегшити зловмисникам пошук вразливостей у інтерфейсній частині додатку або збір з нього конфіденційної інформації. Огляд коду JavaScript повинен бути виконаний для того, щоб визначити, чи відкриті до доступу будь-які налагоджувальні файли з інтерфейсу. Залежно від контексту і конфіденційності проєкту, експерт з безпеки повинен вирішити, чи повинні ці файли існувати у виробничому середовищі чи ні.

# Цілі тестування

- Перегляньте коментарі та метадані веб-сторінок на предмет витоків інформації.
- Зберіть файли JavaScript і перегляньте їхній код, щоб краще зрозуміти додаток і знайти витоки інформації.
- Визначте, чи існують файли карт вихідного коду або інші налагоджувальні файли інтерфейсу.

# Як Здійснюється Тестування

## Огляд коментарів та метаданих сторінки

HTML-коментарі часто використовуються розробниками для включення налагоджувальної інформації про програму. Іноді вони забувають про коментарі і залишають їх у виробничому середовищі. Тестувальники повинні шукати HTML-коментарі, які починаються з `<!--`.

Перевіряйте вихідний код HTML на наявність коментарів, що містять конфіденційну інформацію, яка може допомогти зловмиснику отримати більше інформації про програму. Це може бути код SQL, імена користувачів і паролі, внутрішні IP-адреси або налагоджувальна інформація.

    ...
    <div class="table2">
      <div class="col1">1</div><div class="col2"> Марічка </div>
      <div class="col1">2</div><div class="col2"> Петро </div>
      <div class="col1">3</div><div class="col2"> Йосип </div>

    <!-- Запит: SELECT id, name FROM app.users WHERE active='1' -->

    </div>
    ...

Тестувальник, можливо, навіть зможе знайти щось на кшталт:

    <!-- Для тестування використайте пароль адміністратора БД: н3сnP@вжн1йParolb -->

Перевірте інформацію про версію HTML на наявність дійсних номерів версій та URL-адрес визначення типів даних (Data Type Definition, DTD):

    <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

- `strict.dtd` – суворий DTD за замовчуванням
- `loose.dtd` – несуворий DTD
- `frameset.dtd` – DTD для документів у наборі рамок (frameset)

Деякі теги `META` не надають активних векторів атаки, але натомість дозволяють зловмиснику здійснити аналіз метрик (профілювання) додатку:

    <META name="Автор" content="Андрій Мельник">

Поширеним (але таким, що не відповідає правилам [WCAG](https://www.w3.org/WAI/standards-guidelines/wcag/)) тегом `META` є [Refresh (перезавантаження сторінки)](https://en.wikipedia.org/wiki/Meta_refresh).

    <META http-equiv="Refresh" content="15;URL=https://www.owasp.org/index.html">

Тег `META` також часто використовується для вказування ключових слів, які пошукова система може використовувати для покращення якості результатів пошуку.

    <META name="keywords" lang="en-us" content="OWASP, безпека, сонечко, льодяники">

Хоча більшість веб-серверів керують індексацією пошукових систем за допомогою файлу `robots.txt`, нею також можна керувати тегами `META`. Наведений нижче тег рекомендує роботам не індексувати і не переходити за посиланнями на HTML-сторінці, що містить цей тег.

    <META name="robots" content="none">

[Платформа для відбору інтернет-контенту (Platform for Internet Content Selection, PICS)](https://www.w3.org/PICS/) і [Протокол для ресурсів веб-опису (Protocol for Web Description Resources, POWDER)](https://www.w3.org/2007/powder/) забезпечують інфраструктуру для зв'язування метаданих з інтернет-контентом.

## Ідентифікація коду JavaScript та збір файлів JavaScript

Програмісти часто вбудовують у код конфіденційну інформацію за допомогою змінних JavaScript в інтерфейсній частині застосунку. Тестувальники повинні перевіряти вихідний код HTML і шукати код JavaScript між тегами `<script>` і `</script>`. Тестувальники також повинні ідентифікувати зовнішні файли JavaScript для перегляду коду (файли JavaScript мають розширення `.js`, а ім'я файлу JavaScript зазвичай міститься в атрибуті `src` (source, вихідний код) тегу `<script>`).

Перевірте код JavaScript на наявність витоків конфіденційної інформації, які можуть бути використані зловмисниками для подальшого зловживання або маніпулювання системою. Шукайте такі значення, як Ключі API, внутрішні IP-адреси, конфіденційні маршрути або дані обліковиї записів. Наприклад:

    const myS3Credentials = {
      accessKeyId: config('AWSS3IDКлючаДоступу'),
      secretAcccessKey: config('AWSS3ТаємнийКодДоступу'),
    };

Тестувальник, можливо, навіть зможе знайти щось на кшталт:

    var conString = "tcp://postgres:1234@localhost/postgres";

Коли ключ API знайдено, тестувальники можуть перевірити, чи встановлені обмеження на ключ API для кожного сервісу окремо, чи за IP-адресою, HTTP-направником, додатком, SDK тощо.

Наприклад, якщо тестувальники знайшли ключ API Google Map, вони можуть перевірити, чи цей ключ API обмежений за IP-адресою, чи обмежений лише для окремих API Google Map. Якщо ключ API Google обмежений лише для окремих API Google Map, зловмисники все одно можуть використовувати цей ключ API для запитів до незахищених API Google Map, а власник додатку повинен буде за це заплатити.

    <script type="application/json">
    ...
    {"GOOGLE_MAP_API_KEY":"AIzaSyDUEBnKgwiqMNpDplT6ozE4Z0XxuAbqDi4", "RECAPTCHA_KEY":"6LcPscEUiAAAAHOwwM3fGvIx9rsPYUq62uRhGjJ0"}
    ...
    </script>

У деяких випадках тестувальники можуть знайти вразливі маршрути в JavaScript-коді, наприклад, посилання на внутрішні або приховані сторінки адміністраторів.

    <script type="application/json">
    ...
    "runtimeConfig":{"BASE_URL_VOUCHER_API":"https://staging-voucher.victim.net/api", "BASE_BACKOFFICE_API":"https://10.10.10.2/api", "ADMIN_PAGE":"/hidden_administrator"}
    ...
    </script>

## Ідентифікація файлів карт вихідного коду

Файли карт вихідного коду зазвичай завантажуються при відкритті DevTools. Тестувальники також можуть знайти файли вихідних карт, додавши розширення ".map" після розширення кожного зовнішнього JavaScript-файлу. Наприклад, якщо тестувальник бачить файл `/static/js/main.chunk.js`, він може перевірити наявність у нього файлу карти вихідного коду, відвідавши `/static/js/main.chunk.js.map`.

### Тестування Методом Чорної Коробки (Black-Box)

Перевірте файли карт вихідного коду на наявність конфіденційної інформації, яка може допомогти зловмиснику отримати більше знань про програму. Наприклад:

    {
      "version": 3,
      "file": "static/js/main.chunk.js",
      "sources": [
        "/home/sysadmin/cashsystem/src/actions/index.js",
        "/home/sysadmin/cashsystem/src/actions/reportAction.js",
        "/home/sysadmin/cashsystem/src/actions/cashoutAction.js",
        "/home/sysadmin/cashsystem/src/actions/userAction.js",
        "..."
      ],
      "..."
    }

Коли веб-сайти завантажують файли карт вихідного коду, код інтерфейсної частини застосування стає більш читабельним і його легше налагоджувати.

# Інструменти

- [Wget](https://www.gnu.org/software/wget/wget.html)
- Функція "переглянути код сторінки" у браузерів
- Очі
- [Curl](https://curl.se/)
- [Burp Suite](https://portswigger.net/burp)
- [Waybackurls](https://github.com/tomnomnom/waybackurls)
- [Google Maps API Scanner](https://github.com/ozguralp/gmapsapiscanner/)

# Перелік посилань

- [KeyHacks](https://github.com/streaak/keyhacks)
- [HTML версії 4.01](https://www.w3.org/TR/1999/REC-html401-19991224)
- [XHTML](https://www.w3.org/TR/2010/REC-xhtml-basic-20101123/)
- [HTML версії 5](https://www.w3.org/TR/html5/)
